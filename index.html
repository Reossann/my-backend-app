<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>
</head>
<body>

    <h1>Todoリスト</h1>
    <input type="text" id="todo-title" placeholder="新しいTodoを入力">
    <button id="add-todo">追加</button>
    <ul id="todo-list">
        </ul>

    <script>
        // Todoリストをサーバーから取得して画面に描画する関数
        const fetchAndRenderTodos = async () => {
            try {
                // 1. サーバーから最新のTodoリストを取得する
                const response = await fetch('http://localhost:3000/todos');
                const todos = await response.json();

                const todoList = document.getElementById('todo-list');
                todoList.innerHTML = ''; // リストを一度空にする

                // 2. 取得したTodoの数だけループ処理を行う
                todos.forEach(todo => {
                    const li = document.createElement('li');

                    // Todoのタイトルを表示する部分
                    const titleSpan = document.createElement('span');
                    titleSpan.textContent = todo.title;
                    li.appendChild(titleSpan);
                    
                    // --- 削除ボタンの作成 ---
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = '削除';
                    deleteButton.addEventListener('click', async () => {
                        if (confirm('本当に削除しますか？')) {
                            await fetch(`http://localhost:3000/todos/${todo.id}`, {
                                method: 'DELETE'
                            });
                            // 削除が成功したら、リストを再描画する
                            fetchAndRenderTodos(); 
                        }
                    });
                    li.appendChild(deleteButton);

                    // --- 更新ボタンの作成 ---
                    const editButton = document.createElement('button');
                    editButton.textContent = '更新';
                    editButton.addEventListener('click', () => {
                        // 現在のタイトルをインプットボックスに置き換える（インライン編集）
                        const newTitle = prompt('新しいタイトルを入力してください', todo.title);

                        if (newTitle && newTitle.trim() !== '') {
                            fetch(`http://localhost:3000/todos/${todo.id}`, {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ title: newTitle })
                            }).then(() => {
                                // 更新が成功したら、リストを再描画する
                                fetchAndRenderTodos();
                            });
                        }
                    });
                    li.appendChild(editButton);

                    // 3. 完成したli要素をulに追加する
                    todoList.appendChild(li);
                });

            } catch (error) {
                console.error('データの取得に失敗しました:', error);
            }
        };

        // ページが読み込まれたら、最初のTodoリストを描画する
        window.onload = fetchAndRenderTodos;

        // 「追加」ボタンがクリックされたときの処理 (前回と同じ)
        document.getElementById('add-todo').addEventListener('click', async () => {
            const titleInput = document.getElementById('todo-title');
            const newTodoTitle = titleInput.value;

            if (!newTodoTitle) return;

            await fetch('http://localhost:3000/todos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: newTodoTitle }),
            });

            // 追加が成功したら、入力欄を空にしてリストを再描画する
            titleInput.value = '';
            fetchAndRenderTodos();
        });
    </script>

</body>
</html>